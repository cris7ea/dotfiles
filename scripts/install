#!/bin/sh

if [ -e ~/.ssh/id_rsa ]
then
  echo "‚Ä∫‚Ä∫‚Ä∫ We have a SSH private key! Testing Github connection..."
  ssh -T git@github.com
else
  echo "‚Ä∫‚Ä∫‚Ä∫ Terminating script: No SSH private key üòù"
  exit 1
fi

# Ask for root password
sudo -v

# Set macOS defaults
echo "‚Ä∫‚Ä∫‚Ä∫ set-macOS-defaults"
macOSDefaults.sh

# Install macOS software
echo "‚Ä∫‚Ä∫‚Ä∫ sudo softwareupdate -i -a"
sudo softwareupdate -i -a

# Install homebrew
if test ! $(which brew)
then
  echo "‚Ä∫‚Ä∫‚Ä∫ Installing Homebrew for you."
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

# Update homebrew
echo "‚Ä∫‚Ä∫‚Ä∫ brew update"
brew update

# Upgrade Out-of-date Software
echo "‚Ä∫‚Ä∫‚Ä∫ brew upgrade"
brew upgrade -all

# Run Homebrew through the Brewfile
echo "‚Ä∫‚Ä∫‚Ä∫ brew bundle"
brew bundle

# Install more recent versions of some macOS tools.
brew install macvim --HEAD --with-cscope --with-lua --with-override-system-vim --with-luajit --with-python
brew link macvim
brew install homebrew/dupes/grep
brew install homebrew/dupes/openssh
brew install homebrew/dupes/screen
# brew install homebrew/php/php56 --with-gmp

# Install/Upgrade Oh-My-Zsh
if test $(find ~/dotfiles/oh-my-zsh/oh-my-zsh.sh)
then
  echo "‚Ä∫‚Ä∫‚Ä∫ Oh-My-Zsh exists!"
else
  echo "‚Ä∫‚Ä∫‚Ä∫ Installing oh-my-zsh"
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
fi

# Copy nvim files
if [ -e ~/.nvm ]
then
  echo "‚Ä∫‚Ä∫‚Ä∫ NVM config exists!"
else
  echo "‚Ä∫‚Ä∫‚Ä∫ Installing NVM!"
  curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.2/install.sh | bash
fi

# Init nvim
if [ -e ~/.vim/pack ]
then
  echo "‚Ä∫‚Ä∫‚Ä∫ VIM pack exists!"
else
  echo "‚Ä∫‚Ä∫‚Ä∫ Installing Minpac!"
  mkdir -p ~/.vim/pack/minpac/opt
  cd ~/.vim/pack/minpac/opt
  git clone https://github.com/k-takata/minpac.git
fi

# initDotfiles (must run after oh-my-zsh install)
echo "‚Ä∫‚Ä∫‚Ä∫ Initializing Dotfiles"
./initDotfiles
source ~/.zshrc

# Copy nvim files
if [ -e ~/.config/nvim ]
then
  echo "‚Ä∫‚Ä∫‚Ä∫ NeoVim config exists!"
else
  echo "‚Ä∫‚Ä∫‚Ä∫ NeoVim config copy!"
  cp -r $DOTFILES/nvim ~/.config/
fi

echo "‚Ä∫‚Ä∫‚Ä∫ Python Installs"
pip2 install --user neovim
pip3 install neovim-remote

echo "‚Ä∫‚Ä∫‚Ä∫ Ruby Installs"
gem install neovim

echo "‚Ä∫‚Ä∫‚Ä∫ Install NPM Latest"
npm i npm@latest -g

echo "‚Ä∫‚Ä∫‚Ä∫ Node Installs"
nvm install node
nvm alias default stable
if test ! $(which spoof)
then
  npm install -g spoof es-ctags
fi

echo "‚Ä∫‚Ä∫‚Ä∫ Adding symlink for GNU core utilities"
ln -s /usr/local/bin/gsha256sum /usr/local/bin/sha256sum

echo "‚Ä∫‚Ä∫‚Ä∫ Install Done!"
